C51 COMPILER V9.00   PWM                                                                   03/07/2018 21:33:05 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN pwm.OBJ
COMPILER INVOKED BY: C:\Program Files\C51\BIN\C51.EXE pwm.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "pwm.h"
   2          #include "serial.h"
   3          
   4          void pwm_config()
   5          {
   6   1      /*
   7   1         ÉèÖÃPWMÏà¹Ø¶Ë¿ÚÄ£Ê½
   8   1      */
   9   1              //½«P1¿ÚºÍPWMÏà¹ØµÄ¶Ë¿ÚÉèÖÃÎª×¼Ë«Ïò¿ÚÄ£Ê½£ºPWM6 = P1^6 , PWM7 = P1^7
  10   1              P1M0 &= ~0xc0;  
  11   1              P1M1 &= ~0xc0;
  12   1      
  13   1          //½«P4¿ÚºÍPWMÏà¹ØµÄ¶Ë¿ÚÉèÖÃÎª×¼Ë«Ïò¿ÚÄ£Ê½£ºPWM3_2 = P4^5, PWM4_2 = P4^4, PWM5_2 = P4^2
  14   1              P4M0 &= ~0x30;  
  15   1              P4M1 &= ~0x30;
  16   1      
  17   1      /*
  18   1         ÉèÖÃPWMÏà¹ØµÄÌØÊâ¹¦ÄÜ¼Ä´æÆ÷
  19   1      */
  20   1      
  21   1      //  À©Õ¹SFR·ÃÎÊ¿ØÖÆ¹¦ÄÜÊ¹ÄÜ£¬ÒÔ±ãÎÒÃÇ¿ÉÒÔ·ÃÎÊPWMÏà¹ØµÄ¼Ä´æÆ÷£¬ Èç¹û¹Ø±Õ£¬ÔòÎÞ·¨²Ù×÷PWM¿ªÍ·µÄ¼Ä´æÆ÷
  22   1              P_SW2 |= 0x80;
  23   1      
  24   1      
  25   1      // ÉèÖÃ PWM2~7 Êä³ö¶Ë¿Ú
  26   1       //   PWM3T1 = 3000;
  27   1      //    PWM3T2 = 0;
  28   1              PWM3CR = 0x08;                          //PWM3_2 = P4^5
  29   1              PWM4CR = 0x08;                          //PWM4_2 = P4^4
  30   1              PWM6CR = 0x00;                      //PWM6 = P1^6
  31   1              PWM7CR = 0x00;                          //PWM7 = P1^7
  32   1      
  33   1      
  34   1      /*
  35   1          ÉèÖÃPWM2~7µÄÊä³ö³õÊ¼µçÆ½Îª0 , 
  36   1              note: Èç¹û²»ÉèÖÃPWMxT1»ò PWMxT2µÄÇé¿öÏÂ£¬ÎÞÂÛ³õÊ¼µçÆ½Îª0»¹ÊÇ1£¬ÏàÓ¦µÄ¶Ë¿ÚµçÑ¹¶¼Îªvss/2, ¶ø²»ÊÇvss»ò0£¬´ý½
             -â¾ö£¡
  37   1      */
  38   1          PWMCFG |= 0x3f;
  39   1      
  40   1      /* 
  41   1          PWMCR  PWM¿ØÖÆ¼Ä´æÆ÷
  42   1              ENC7O ~ ENC2O
  43   1              0:  ÉèÖÃÎªGPIO¿Ú
  44   1              1£º ÉèÖÃÎªPWMÊä³ö¿Ú£¬ÊÜPWM²¨ÐÎ¿ØÖÆÆ÷¿ØÖÆ£¬×¢Òâ£º´ËÊ±ÈçºÎÖ±½Ó¸øIO¿Ú¸³ÖµÎÞÐ§£¬±ÈÈç£ºP4^5 = 0 »ò PWM3 = 0 Õâ
             -ÑùµÄÃüÁîÎÞÐ§
  45   1              ÏÂÃæÊÇÉèÖÃPWM3,4,6,7ÎªPWMÊä³ö¿Ú
  46   1      */
  47   1          PWMCR = 0x36;
  48   1      
  49   1      /*  
  50   1          ÉèÖÃPWMÖÜÆÚ
  51   1          PWMC PWM¼ÆÊýÆ÷£¬´ÓCYCLEµÄ¿ªÊ¼µ¹¼ÆÊý£¬¼õµ½0Ê±ÖØÐÂ´ÓCYCLE¿ªÊ¼µ¹¼ÆÊý¡£
  52   1          ÅäºÏPWMxT1£¬PWMxT2Ê¹ÓÃ¼´¿É¿ØÖÆÕ¼¿Õ±È
  53   1              ¼ÙÈç´ËÊ±CYCLE = 4096£¬PWMxT1 = 1024£¬PWM³õÊ¼µçÆ½Îª0£¬ÔòPWMC = 1024Ê±£¬PWMµçÆ½Ìø×ª£¬Õ¼¿Õ±ÈÎª1/4 
C51 COMPILER V9.00   PWM                                                                   03/07/2018 21:33:05 PAGE 2   

  54   1      */
  55   1          PWMC = CYCLE;
  56   1      
  57   1      //  ÉèÖÃPWMÊ±ÖÓÑ¡Ôñ¼Ä´æÆ÷
  58   1              PWMCKS = 0x00;
  59   1      
  60   1      //      PWM3T1 = 3000;
  61   1      //  Ê¹ÄÜPWM£¬ ¿ªÊ¼¼ÆÊý
  62   1          PWMCR |= 0x80;
  63   1              
  64   1      }
  65          
  66          void PWM3_setPwmWidth(int width)
  67          {
  68   1         if (0 == width)
  69   1         {
  70   2            PWMCR &= ~0x02;
  71   2                PWM3 = 0;
  72   2         }else if (CYCLE == width)
  73   1         {
  74   2                PWMCR &= ~0x02;
  75   2                PWM3 = 1;
  76   2         }else
  77   1         {  
  78   2            PWM3T1 = width;
  79   2                PWMCR |= 0x02;
  80   2         }
  81   1      
  82   1      }
  83          
  84          void PWM4_setPwmWidth(int width)
  85          {
  86   1         if (0 == width)
  87   1         {
  88   2            PWMCR &= ~0x04;
  89   2                PWM4 = 0;
  90   2         }else if (CYCLE == width)
  91   1         {
  92   2                PWMCR &= ~0x04;
  93   2                PWM4 = 1;
  94   2         }else
  95   1         {  
  96   2            PWM4T1 = width;
  97   2                PWMCR |= 0x04;
  98   2         }
  99   1      
 100   1      }
 101          
 102          void PWM6_setPwmWidth(int width)
 103          {
 104   1         if (0 == width)
 105   1         {
 106   2            PWMCR &= ~0x10;
 107   2                PWM6 = 0;
 108   2         }else if (CYCLE == width)
 109   1         {
 110   2                PWMCR &= ~0x10;
 111   2                PWM6 = 1;
 112   2         }else
 113   1         {  
 114   2            PWM6T1 = width;
 115   2                PWMCR |= 0x10;
C51 COMPILER V9.00   PWM                                                                   03/07/2018 21:33:05 PAGE 3   

 116   2         }
 117   1      
 118   1      }
 119          
 120          void PWM7_setPwmWidth(int width)
 121          {
 122   1         if (0 == width)
 123   1         {
 124   2            PWMCR &= ~0x20;
 125   2                PWM7 = 0;
 126   2         }else if (CYCLE == width)
 127   1         {
 128   2                PWMCR &= ~0x20;
 129   2                PWM7 = 1;
 130   2         }else
 131   1         {  
 132   2            PWM7T1 = width;
 133   2                PWMCR |= 0x20;
 134   2         }
 135   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    199    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
